{% extends 'base.html' %}

{% block content %}
<style>
    /* Estilos específicos para a página de listagem de simulados arquivados */
    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-bottom: 1rem;
        margin-bottom: 2.5rem !important;
        border-bottom: 2px solid;
        border-image-slice: 1;
        border-image-source: var(--accent-gradient);
    }

    .page-header h2 {
        font-family: var(--font-title);
        color: var(--text-primary);
        font-size: 2.5rem;
        letter-spacing: 1px;
        margin: 0;
    }

    /* Card de simulado */
    .simulado-card .card-body {
        padding: 1.5rem;
    }

    .simulado-card .card-title {
        color: var(--color-primary);
    }

    .simulado-card .card-text i {
        color: var(--color-primary);
    }

    .simulado-card .card-text span {
        color: var(--text-primary);
        font-weight: 500;
    }

    /* Estilização dos botões de ação */
    .action-buttons {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
    }

    .action-buttons .btn {
        flex-grow: 1;
        font-size: 0.8rem;
        font-weight: 600;
        background: transparent;
        border: 1px solid var(--border-color);
        color: var(--text-primary);
        padding: 0.4rem 0.6rem;
    }

    .action-buttons .btn:hover {
        color: white !important;
        background: var(--color-primary);
        border-color: var(--color-primary);
        transform: translateY(-2px);
    }

    .action-buttons .btn i {
        color: inherit;
    }

    /* Botão de desarquivar */
    .action-buttons .btn-success-custom {
        border-color: var(--color-success);
        color: var(--color-success) !important;
    }

    .action-buttons .btn-success-custom:hover {
        background: var(--color-success);
        border-color: var(--color-success);
        color: white !important;
    }

    /* Alerta de "Nenhum simulado" */
    .alert.alert-info {
        background-color: rgba(0, 164, 217, 0.1);
        border-color: var(--color-primary);
        color: var(--color-primary);
        font-weight: 500;
    }
</style>

<div class="container mt-4">
    <div class="page-header mb-4">
        <h2>Simulados Arquivados</h2>
        <a href="{% url 'questions:simulado_list' %}" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> Voltar para Simulados
        </a>
    </div>

    <div id="simulados-container">
        {% if simulados %}
        <div class="row">
            {% for simulado in simulados %}
            <div class="col-lg-6 mb-4" id="simulado-col-{{ simulado.id }}">
                <div class="card simulado-card" data-simulado-id="{{ simulado.id }}">
                    <div class="card-body">
                        <h5 class="card-title">{{ simulado.titulo }}</h5>
                        <div class="card-text mt-3">
                            <div class="d-flex align-items-center mb-2">
                                <i class="bi bi-question-circle me-2"></i>
                                <span>{{ simulado.questoes.count }} questões</span>
                            </div>
                            <div class="d-flex align-items-center">
                                <i class="bi bi-calendar me-2"></i>
                                <span>Criado em {{ simulado.data_criacao|date:"d/m/Y" }}</span>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer">
                        <div class="action-buttons">
                            <button class="btn btn-sm btn-success-custom unarchive-simulado"
                                    data-simulado-id="{{ simulado.id }}"
                                    title="Desarquivar simulado">
                                <i class="bi bi-box-arrow-up"></i> Desarquivar
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="alert alert-info">
            Nenhum simulado arquivado.
        </div>
        {% endif %}
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.unarchive-simulado').forEach(button => {
        button.addEventListener('click', function() {
            const simuladoId = this.getAttribute('data-simulado-id');
            const url = `/api/simulados/${simuladoId}/unarchive/`;

            fetch(url, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'simulado desarquivado') {
                    const cardColuna = document.getElementById(`simulado-col-${simuladoId}`);
                    if (cardColuna) {
                        cardColuna.style.transition = 'opacity 0.5s ease';
                        cardColuna.style.opacity = '0';
                        setTimeout(() => cardColuna.remove(), 500);
                    }

                    // Verifica se ainda há simulados arquivados
                    setTimeout(() => {
                        const container = document.getElementById('simulados-container');
                        if (container.querySelectorAll('.simulado-card').length === 0) {
                            container.innerHTML = `
                                <div class="alert alert-info" role="alert">
                                    Nenhum simulado arquivado.
                                </div>
                            `;
                        }
                    }, 550);
                } else {
                    alert('Erro ao desarquivar o simulado.');
                }
            })
            .catch(error => {
                console.error('Erro:', error);
                alert('Erro de conexão ao tentar desarquivar o simulado.');
            });
        });
    });
});
</script>

{% endblock %}